---
title: "Лабораторна робота № 4. Перевірка статистичних гіпотез щодо закону розподілу"
author: "Процко Поліна"
date: "`r Sys.Date()`"
format: 
  html:
    toc: true
    code-fold: show
    self-contained: true
editor: visual
bibliography: references.bib
lang: uk
---

## 1. Постановка завдання

**Мета:** Засвоїти методику перевірки статистичних гіпотез щодо закону розподілу випадкової величини, зокрема перевірку на нормальність, з використанням мови R [@manual2024].

**Завдання (за варіантом "Еталонний"):**

1.  Згенерувати вибірку випадкової величини $X$, що має нормальний закон розподілу з параметрами $\mu=0$ та $\sigma=1$.
2.  Розглянути два випадки об'єму вибірки: $n=50$ та $n=1000$.
3.  Для кожного випадку:
    -   Обчислити описові статистики (включно з асиметрією та ексцесом).
    -   Побудувати графіки (гістограма, boxplot, Q-Q plot).
    -   Перевірити гіпотезу про нормальність за допомогою статистичних критеріїв ($\alpha=0.05$).

**Гіпотези:** $$H_0: X \sim N(\mu, \sigma^2)$$ $$H_1: X \nsim N(\mu, \sigma^2)$$

------------------------------------------------------------------------

## 2. Короткі теоретичні відомості

Перевірка на нормальність складається з оцінки параметрів, візуального аналізу та застосування статистичних критеріїв.

Основные числові характеристики форми розподілу:

**Вибіркова асиметрія (Skewness):** $$A_s = \frac{n}{(n-1)(n-2)} \sum \left(\frac{x_i - \bar{x}}{s}\right)^3$$

**Вибірковий ексцес (Kurtosis):** $$E_k = \frac{n(n+1)}{(n-1)(n-2)(n-3)} \sum \left(\frac{x_i - \bar{x}}{s}\right)^4 - \frac{3(n-1)^2}{(n-2)(n-3)}$$

Критерії перевірки (рівень значущості $\alpha = 0.05$):

1.  **Шапіро-Вілка:** Найпотужніший для малих вибірок.
2.  **Колмогорова-Смирнова (Ліллієфорса):** Для складних гіпотез (параметри оцінюються за вибіркою).
3.  **Пірсона (**$\chi^2$): Універсальний критерій.

------------------------------------------------------------------------

## 3. Виконання роботи

### 3.1 Підготовка інструментів (Functions Level 2)

Реалізуємо власні функції для розрахунку статистик та автоматизованої перевірки гіпотез, як того вимагає завдання (рівень 2).

```{r}
#| label: setup
#| message: false
#| warning: false

library(knitr)
# Встановіть цей пакет, якщо він відсутній: install.packages("nortest")
library(nortest) # Пакет для тестів Ліллієфорса, Андерсона-Дарлінга та ін.

# Створення папки data, якщо вона відсутня (вимога методички)
if (!dir.exists("data")) {
  dir.create("data")
}

# --- ФУНКЦІЯ 1: Розрахунок детальних описових статистик ---
get_descriptive_stats <- function(x) {
  n <- length(x)
  m <- mean(x)
  s <- sd(x)
  
  # Асиметрія (формула для незсуненої оцінки)
  skew <- (n / ((n - 1) * (n - 2))) * sum(((x - m) / s)^3)
  
  # Ексцес (формула для незсуненої оцінки)
  kurt <- ((n * (n + 1)) / ((n - 1) * (n - 2) * (n - 3))) * sum(((x - m) / s)^4) - (3 * (n - 1)^2) / ((n - 2) * (n - 3))
  
  # Стандартизовані значення
  z_skew <- skew / sqrt(6/n)
  z_kurt <- kurt / sqrt(24/n)
  
  # Формування таблиці
  res <- data.frame(
    Parameter = c("Mean", "SD", "Skewness", "Kurtosis", "Z-Skew", "Z-Kurt"),
    Value = round(c(m, s, skew, kurt, z_skew, z_kurt), 4)
  )
  return(res)
}

# --- ФУНКЦІЯ 2: Зведена таблиця тестів на нормальність ---
check_normality_tests <- function(x) {
  # Тест Шапіро-Вілка
  sw <- shapiro.test(x)
  
  # Тест Ліллієфорса (модифікація Колмогорова-Смирнова)
  ks_l <- lillie.test(x)
  
  # Тест Андерсона-Дарлінга
  ad <- ad.test(x)
  
  # Тест Пірсона (Хі-квадрат)
  chi <- pearson.test(x)
  
  # Тест Шапіро-Франсія
  sf <- sf.test(x)
  
  # Зведення результатів
  tests <- data.frame(
    Test = c("Shapiro-Wilk", "Lilliefors (KS)", "Anderson-Darling", 
             "Pearson Chi-Square", "Shapiro-Francia"),
    Statistic = round(c(sw$statistic, ks_l$statistic, ad$statistic, 
                        chi$statistic, sf$statistic), 4),
    P_Value = round(c(sw$p.value, ks_l$p.value, ad$p.value, 
                      chi$p.value, sf$p.value), 4)
  )
  
  # Додавання висновку
  tests$Conclusion = ifelse(tests$P_Value > 0.05, "Normality Accepted", "Normality Rejected")
  
  return(tests)
}

# --- ФУНКЦІЯ 3: Комплексна візуалізація ---
plot_diagnostics <- function(x, title_suffix = "") {
  op <- par(mfrow = c(2, 2)) # Сітка 2х2
  
  # 1. Точкова діаграма
  plot(x, main = paste("Scatterplot", title_suffix), col = "blue", pch = 19, cex = 0.6)
  
  # 2. Boxplot
  boxplot(x, main = "Boxplot", col = "lightblue", horizontal = TRUE)
  
  # 3. Гістограма з кривою щільності
  hist(x, freq = FALSE, main = "Histogram & Density", col = "grey90", xlab = "X")
  lines(density(x), col = "red", lwd = 2)
  curve(dnorm(x, mean(x), sd(x)), add = TRUE, col = "blue", lty = 2, lwd = 2)
  legend("topright", legend = c("Empirical", "Theoretical"), 
         col = c("red", "blue"), lty = c(1, 2), cex = 0.7)
  
  # 4. Q-Q Plot
  qqnorm(x, main = "Q-Q Plot", col = "blue", pch = 19, cex = 0.6)
  qqline(x, col = "red", lwd = 2)
  
  par(op) # Скидання налаштувань
}
```

### 3.2 Дослідження для n = 50

Згенеруємо вибірку малого обсягу, збережемо її у файл (згідно з методикою) та проаналізуємо.

```{r}
#| label: analysis-50
#| fig-height: 8

# Генерація та збереження
set.seed(42) # Для відтворюваності
n1 <- 50
X_50 <- rnorm(n1, mean = 0, sd = 1)

# Запис у файл (вимога методички)
write.table(X_50, file = "data/X_50.csv", row.names = FALSE, col.names = FALSE)

# Зчитування з файлу
X_50_loaded <- read.table("data/X_50.csv")$V1

# 1. Числові характеристики
stats_50 <- get_descriptive_stats(X_50_loaded)
kable(stats_50, caption = "Описові статистики (n=50)")

# 2. Візуалізація
plot_diagnostics(X_50_loaded, "(n=50)")

# 3. Перевірка гіпотез
tests_50 <- check_normality_tests(X_50_loaded)
kable(tests_50, caption = "Результати тестів на нормальність (n=50)")
```

**Аналіз (n=50):** \* **Асиметрія та Ексцес:** Стандартизовані значення ($Z$-scores) знаходяться в межах $[-2, 2]$, що свідчить на користь нормальності. \* **Графіки:** Гістограма може виглядати дещо "рваною" через малий обсяг вибірки, але Q-Q plot показує точки, що лежать близько до прямої. \* **Тести:** P-value у всіх тестах значно більше 0.05. Ми не маємо підстав відхилити нульову гіпотезу про нормальний розподіл.

### 3.3 Дослідження для n = 1000

Повторимо процедуру для великої вибірки.

```{r}
#| label: analysis-1000
#| fig-height: 8

# Генерація та збереження
set.seed(42)
n2 <- 1000
X_1000 <- rnorm(n2, mean = 0, sd = 1)

# Запис у файл
write.table(X_1000, file = "data/X_1000.csv", row.names = FALSE, col.names = FALSE)

# Зчитування з файлу
X_1000_loaded <- read.table("data/X_1000.csv")$V1

# 1. Числові характеристики
stats_1000 <- get_descriptive_stats(X_1000_loaded)
kable(stats_1000, caption = "Описові статистики (n=1000)")

# 2. Візуалізація
plot_diagnostics(X_1000_loaded, "(n=1000)")

# 3. Перевірка гіпотез
tests_1000 <- check_normality_tests(X_1000_loaded)
kable(tests_1000, caption = "Результати тестів на нормальність (n=1000)")
```

**Аналіз (n=1000):** \* **Описова статистика:** Середнє та дисперсія дуже близькі до теоретичних (0 та 1). \* **Графіки:** Гістограма має чітко виражену дзвоноподібну форму. На Q-Q plot точки ідеально лягають на лінію. \* **Тести:** P-values залишаються високими (\> 0.05), підтверджуючи нормальність.

------------------------------------------------------------------------

## 4. Висновки

У ході лабораторної роботи було перевірено гіпотезу про нормальний розподіл для двох вибірок ($n=50$ та $n=1000$), згенерованих з генеральної сукупності $N(0, 1)$.

1.  **Вплив обсягу вибірки:**

    -   При $n=50$ візуальні методи (гістограма) можуть бути суб'єктивними і не завжди чітко показувати "дзвін", проте статистичні критерії (особливо Шапіро-Вілка) коректно ідентифікують нормальність.
    -   При $n=1000$ емпіричний розподіл майже ідеально збігається з теоретичним, що підтверджується як графічно, так і всіма статистичними тестами.

2.  **Результати тестів:** Усі використані критерії (Шапіро-Вілка, Ліллієфорса, Пірсона та ін.) показали $p > 0.05$ для обох вибірок. Це означає, що нульова гіпотеза про нормальний закон розподілу приймається.

3.  **Програмна реалізація:** Розроблено функції користувача мовою R для автоматизації розрахунку описових статистик та проведення пакетної перевірки гіпотез, що відповідає вимогам 2-го рівня складності.

------------------------------------------------------------------------

## Перелік посилань

::: {#refs}
:::
